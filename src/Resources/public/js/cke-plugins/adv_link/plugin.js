/**
 * @license Copyright (c) 2003-2015, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or http://ckeditor.com/license
 */
"use strict";!function(){CKEDITOR.plugins.add("adv_link",{requires:"dialog,fakeobjects",lang:"af,ar,bg,bn,bs,ca,cs,cy,da,de,el,en,en-au,en-ca,en-gb,eo,es,et,eu,fa,fi,fo,fr,fr-ca,gl,gu,he,hi,hr,hu,id,is,it,ja,ka,km,ko,ku,lt,lv,mk,mn,ms,nb,nl,no,pl,pt,pt-br,ro,ru,si,sk,sl,sq,sr,sr-latn,sv,th,tr,tt,ug,uk,vi,zh,zh-cn",icons:"anchor,anchor-rtl,link,unlink",hidpi:!0,onLoad:function(){var e="background:url("+CKEDITOR.getUrl(this.path+"images"+(CKEDITOR.env.hidpi?"/hidpi":"")+"/anchor.png")+") no-repeat %1 center;border:1px dotted #00f;background-size:16px;",t=".%2 a.cke_anchor,.%2 a.cke_anchor_empty,.cke_editable.%2 a[name],.cke_editable.%2 a[data-cke-saved-name]{"+e+"padding-%1:18px;cursor:auto;}.%2 img.cke_anchor{"+e+"width:16px;min-height:15px;height:1.15em;vertical-align:text-bottom;}";function a(e){return t.replace(/%1/g,"rtl"==e?"right":"left").replace(/%2/g,"cke_contents_"+e)}CKEDITOR.addCss(a("ltr")+a("rtl"))},init:function(e){var t="a[!href]";CKEDITOR.dialog.isTabEnabled(e,"link","advanced")&&(t=t.replace("]",",accesskey,charset,dir,id,lang,name,rel,tabindex,title,type]{*}(*)")),CKEDITOR.dialog.isTabEnabled(e,"link","target")&&(t=t.replace("]",",target,onclick]")),e.addCommand("link",new CKEDITOR.dialogCommand("link",{allowedContent:t,requiredContent:"a[href]"})),e.addCommand("anchor",new CKEDITOR.dialogCommand("anchor",{allowedContent:"a[!name,id]",requiredContent:"a[name]"})),e.addCommand("unlink",new CKEDITOR.unlinkCommand),e.addCommand("removeAnchor",new CKEDITOR.removeAnchorCommand),e.setKeystroke(CKEDITOR.CTRL+76,"link"),e.ui.addButton&&(e.ui.addButton("Link",{label:e.lang.link.toolbar,command:"link",toolbar:"links,10"}),e.ui.addButton("Unlink",{label:e.lang.link.unlink,command:"unlink",toolbar:"links,20"}),e.ui.addButton("Anchor",{label:e.lang.link.anchor.toolbar,command:"anchor",toolbar:"links,30"})),CKEDITOR.dialog.add("link",this.path+"dialogs/link.js"),CKEDITOR.dialog.add("anchor",this.path+"dialogs/anchor.js"),e.on("doubleclick",(function(t){var a=CKEDITOR.plugins.link.getSelectedLink(e)||t.data.element;a.isReadOnly()||(a.is("a")?(t.data.dialog=!a.getAttribute("name")||a.getAttribute("href")&&a.getChildCount()?"link":"anchor",t.data.link=a):CKEDITOR.plugins.link.tryRestoreFakeAnchor(e,a)&&(t.data.dialog="anchor"))}),null,null,0),e.on("doubleclick",(function(t){t.data.dialog in{link:1,anchor:1}&&t.data.link&&e.getSelection().selectElement(t.data.link)}),null,null,20),e.addMenuItems&&e.addMenuItems({anchor:{label:e.lang.link.anchor.menu,command:"anchor",group:"anchor",order:1},removeAnchor:{label:e.lang.link.anchor.remove,command:"removeAnchor",group:"anchor",order:5},link:{label:e.lang.link.menu,command:"link",group:"link",order:1},unlink:{label:e.lang.link.unlink,command:"unlink",group:"link",order:5}}),e.contextMenu&&e.contextMenu.addListener((function(t){if(!t||t.isReadOnly())return null;var a=CKEDITOR.plugins.link.tryRestoreFakeAnchor(e,t);if(!a&&!(a=CKEDITOR.plugins.link.getSelectedLink(e)))return null;var n={};return a.getAttribute("href")&&a.getChildCount()&&(n={link:CKEDITOR.TRISTATE_OFF,unlink:CKEDITOR.TRISTATE_OFF}),a&&a.hasAttribute("name")&&(n.anchor=n.removeAnchor=CKEDITOR.TRISTATE_OFF),n}));var a=e.config.ems_filesUrl;e.config.baseHref&&(a+="&baseHref="+encodeURIComponent(e.config.baseHref)),e.config.filebrowserUploadMethod="form",e.config.filebrowserBrowseUrl=a,this.compiledProtectionFunction=function(e){var t,a=e.config.emailProtection||"";a&&"encode"!=a&&(t={},a.replace(/^([^(]+)\(([^)]+)\)$/,(function(e,a,n){t.name=a,t.params=[],n.replace(/[^,\s]+/g,(function(e){t.params.push(e)}))})));return t}(e)},afterInit:function(e){e.dataProcessor.dataFilter.addRules({elements:{a:function(t){return t.attributes.name?t.children.length?null:e.createFakeParserElement(t,"cke_anchor","anchor"):null}}});var t=e._.elementsPath&&e._.elementsPath.filters;t&&t.push((function(t,a){if("a"==a&&(CKEDITOR.plugins.link.tryRestoreFakeAnchor(e,t)||t.getAttribute("name")&&(!t.getAttribute("href")||!t.getChildCount())))return"anchor"}))}});var e=/^javascript:/,t=/^mailto:([^?]+)(?:\?(.+))?$/,a=/subject=([^;?:@&=$,\/]*)/,n=/body=([^;?:@&=$,\/]*)/,r=/^#(.*)$/,o=/^ems:\/\/object:(.*):(.*)$/,i=/^((?:http|https|ftp|news):\/\/)?(.*)$/,l=/^(_(?:self|top|parent|blank))$/,c=/^javascript:void\(location\.href='mailto:'\+String\.fromCharCode\(([^)]+)\)(?:\+'(.*)')?\)$/,d=/^javascript:([^(]+)\(([^)]+)\)$/,s=/\s*window.open\(\s*this\.href\s*,\s*(?:'([^']*)'|null)\s*,\s*'([^']*)'\s*\)\s*;\s*return\s*false;*\s*/,u=/(?:^|,)([^=]+)=(\d+|yes|no)/gi,m={id:"advId",dir:"advLangDir",accessKey:"advAccessKey",name:"advName",lang:"advLangCode",tabindex:"advTabIndex",title:"advTitle",type:"advContentType",class:"advCSSClasses",charset:"advCharset",style:"advStyles",rel:"advRel"};function h(e){return e.replace(/\\'/g,"'")}function g(e){return e.replace(/'/g,"\\$&")}function k(e){for(var t,a=e.length,n=[],r=0;r<a;r++)t=e.charCodeAt(r),n.push(t);return"String.fromCharCode("+n.join(",")+")"}function p(e,t){var a,n,r,o=e.plugins.link,i=o.compiledProtectionFunction.name,l=o.compiledProtectionFunction.params;r=[i,"("];for(var c=0;c<l.length;c++)n=t[a=l[c].toLowerCase()],c>0&&r.push(","),r.push("'",n?g(encodeURIComponent(t[a])):"","'");return r.push(")"),r.join("")}CKEDITOR.plugins.link={getSelectedLink:function(e){var t=e.getSelection(),a=t.getSelectedElement();if(a&&a.is("a"))return a;var n=t.getRanges()[0];return n?(n.shrink(CKEDITOR.SHRINK_TEXT),e.elementPath(n.getCommonAncestor()).contains("a",1)):null},getEditorAnchors:function(e){for(var t,a=e.editable(),n=a.isInline()&&!e.plugins.divarea?e.document:a,r=n.getElementsByTag("a"),o=n.getElementsByTag("img"),i=[],l=0;t=r.getItem(l++);)(t.data("cke-saved-name")||t.hasAttribute("name"))&&i.push({name:t.data("cke-saved-name")||t.getAttribute("name"),id:t.getAttribute("id")});for(l=0;t=o.getItem(l++);)(t=this.tryRestoreFakeAnchor(e,t))&&i.push({name:t.getAttribute("name"),id:t.getAttribute("id")});return i},fakeAnchor:!0,tryRestoreFakeAnchor:function(e,t){if(t&&t.data("cke-real-element-type")&&"anchor"==t.data("cke-real-element-type")){var a=e.restoreRealElement(t);if(a.data("cke-saved-name"))return a}},parseLinkAttributes:function(g,k){var p,f,v,C,b=k&&(k.data("cke-saved-href")||k.getAttribute("href"))||"",T=g.plugins.adv_link.compiledProtectionFunction,R=g.config.emailProtection,I={};if(b.match(e)&&("encode"==R?b=b.replace(c,(function(e,t,a){return"mailto:"+String.fromCharCode.apply(String,t.split(","))+(a&&h(a))})):R&&b.replace(d,(function(e,t,a){if(t==T.name){I.type="email";for(var n,r=I.email={},o=/(^')|('$)/g,i=a.match(/[^,\s]+/g),l=i.length,c=0;c<l;c++)n=decodeURIComponent(h(i[c].replace(o,""))),r[T.params[c].toLowerCase()]=n;r.address=[r.name,r.domain].join("@")}}))),!I.type)if(f=b.match(r))I.type="anchor",I.anchor={},I.anchor.name=I.anchor.id=f[1];else if(v=b.match(o))I.type="localPage",I.url=b,I.filter=v[1],I.id=v[1]+":"+v[2];else if(p=b.match(t)){var E=b.match(a),y=b.match(n);I.type="email";var A=I.email={};A.address=p[1],E&&(A.subject=decodeURIComponent(E[1])),y&&(A.body=decodeURIComponent(y[1]))}else b&&(C=b.match(i))&&(I.type="url",I.url={},I.url.protocol=C[1],I.url.url=C[2]);if(k){var O=k.getAttribute("target");if(O)I.target={type:O.match(l)?O:"frame",name:O};else{var K,D=k.data("cke-pa-onclick")||k.getAttribute("onclick"),S=D&&D.match(s);if(S)for(I.target={type:"popup",name:S[1]};K=u.exec(S[2]);)"yes"!=K[2]&&"1"!=K[2]||K[1]in{height:1,width:1,top:1,left:1}?isFinite(K[2])&&(I.target[K[1]]=K[2]):I.target[K[1]]=!0}var w={};for(var _ in m){var j=k.getAttribute(_);j&&(w[m[_]]=j)}var F=k.data("cke-saved-name")||w.advName;F&&(w.advName=F),CKEDITOR.tools.isEmpty(w)||(I.advanced=w)}return I},getLinkAttributes:function(e,t){var a=e.config.emailProtection||"",n={};switch(t.type){case"url":var r=t.url&&void 0!==t.url.protocol?t.url.protocol:"http://",o=t.url&&CKEDITOR.tools.trim(t.url.url)||"";n["data-cke-saved-href"]=0===o.indexOf("/")?o:r+o;break;case"localPage":n["data-cke-saved-href"]=t.localPage;break;case"fileLink":n["data-cke-saved-href"]=t.fileLink;break;case"anchor":var i=t.anchor&&t.anchor.name,l=t.anchor&&t.anchor.id;n["data-cke-saved-href"]="#"+(i||l||"");break;case"email":var c,d=t.email,s=d.address;switch(a){case"":case"encode":var u=encodeURIComponent(d.subject||""),h=encodeURIComponent(d.body||""),f=[];u&&f.push("subject="+u),h&&f.push("body="+h),f=f.length?"?"+f.join("&"):"","encode"==a?(c=["javascript:void(location.href='mailto:'+",k(s)],f&&c.push("+'",g(f),"'"),c.push(")")):c=["mailto:",s,f];break;default:var v=s.split("@",2);d.name=v[0],d.domain=v[1],c=["javascript:",p(e,d)]}n["data-cke-saved-href"]=c.join("")}if(t.target)if("popup"==t.target.type){for(var C=["window.open(this.href, '",t.target.name||"","', '"],b=["resizable","status","location","toolbar","menubar","fullscreen","scrollbars","dependent"],T=b.length,R=function(e){t.target[e]&&b.push(e+"="+t.target[e])},I=0;I<T;I++)b[I]=b[I]+(t.target[b[I]]?"=yes":"=no");R("width"),R("left"),R("height"),R("top"),C.push(b.join(","),"'); return false;"),n["data-cke-pa-onclick"]=C.join("")}else"notSet"!=t.target.type&&t.target.name&&(n.target=t.target.name);if(t.advanced){for(var E in m){var y=t.advanced[m[E]];y&&(n[E]=y)}n.name&&(n["data-cke-saved-name"]=n.name)}n["data-cke-saved-href"]&&(n.href=n["data-cke-saved-href"]);var A={target:1,onclick:1,"data-cke-pa-onclick":1,"data-cke-saved-name":1};for(var O in t.advanced&&CKEDITOR.tools.extend(A,m),n)delete A[O];return{set:n,removed:CKEDITOR.tools.objectKeys(A)}}},CKEDITOR.unlinkCommand=function(){},CKEDITOR.unlinkCommand.prototype={exec:function(e){var t=new CKEDITOR.style({element:"a",type:CKEDITOR.STYLE_INLINE,alwaysRemoveElement:1});e.removeStyle(t)},refresh:function(e,t){var a=t.lastElement&&t.lastElement.getAscendant("a",!0);a&&"a"==a.getName()&&a.getAttribute("href")&&a.getChildCount()?this.setState(CKEDITOR.TRISTATE_OFF):this.setState(CKEDITOR.TRISTATE_DISABLED)},contextSensitive:1,startDisabled:1,requiredContent:"a[href]"},CKEDITOR.removeAnchorCommand=function(){},CKEDITOR.removeAnchorCommand.prototype={exec:function(e){var t,a=e.getSelection(),n=a.createBookmarks();a&&(t=a.getSelectedElement())&&(t.getChildCount()?t.is("a"):CKEDITOR.plugins.link.tryRestoreFakeAnchor(e,t))?t.remove(1):(t=CKEDITOR.plugins.link.getSelectedLink(e))&&(t.hasAttribute("href")?(t.removeAttributes({name:1,"data-cke-saved-name":1}),t.removeClass("cke_anchor")):t.remove(1)),a.selectBookmarks(n)},requiredContent:"a[name]"},CKEDITOR.tools.extend(CKEDITOR.config,{linkShowAdvancedTab:!0,linkShowTargetTab:!0})}();