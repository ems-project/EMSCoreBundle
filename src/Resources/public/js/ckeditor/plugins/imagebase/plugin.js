!function(){function t(t){var e=t.widgets,a=t.focusManager.currentActive;if(t.focusManager.hasFocus){if(e.focused)return e.focused;if(a instanceof CKEDITOR.plugins.widget.nestedEditable)return e.getByElement(a)}}function e(t,e){return t.features&&-1!==CKEDITOR.tools.array.indexOf(t.features,e)}function a(t){this.wrapper=CKEDITOR.dom.element.createFromHtml(t||'<div class="cke_loader"></div>')}function n(){a.call(this,'<div class="cke_loader"><div class="cke_bar" styles="transition: width '+s/1e3+'s"></div></div>'),this.bar=this.wrapper.getFirst()}var i,o=!1,r={caption:function(){function a(t){t.parts.caption.data("cke-caption-placeholder",!1)}function n(t,e){t.data("cke-caption-active",e),t.data("cke-caption-hidden",!e)}return{setUp:function(t){function a(a){var i=(a="blur"===a.name?t.elementPath():a.data.path)?a.lastElement:null;if(a=function(t,a){return CKEDITOR.tools.array.reduce(CKEDITOR.tools.object.keys(t),(function(n,i){var o=t[i];return e(o,a)&&n.push(o),n}),[])}(t.widgets.instances,"caption"),!t.filter.check("figcaption"))return CKEDITOR.tools.array.forEach(n,(function(t){t.removeListener()}));CKEDITOR.tools.array.forEach(a,(function(t){t._refreshCaption(i)}))}var n=[];n.push(t.on("selectionChange",a,null,null,9)),n.push(t.on("blur",a))},init:function(){if(this.editor.filter.check("figcaption")){if(!this.parts.caption){var t=this.parts,e=this.element,a=e.getDocument().createElement("figcaption");e.append(a),this.initEditable("caption",this.definition.editables.caption),t.caption=a}this.editables.caption.getData()||this.parts.caption.data("cke-caption-placeholder")||this._refreshCaption()}},_refreshCaption:function(e){var i=t(this.editor)===this,o=this.parts.caption,r=this.editables.caption;i?(r.getData()||e.equals(o)?(!e||e.equals(o)&&e.data("cke-caption-placeholder"))&&a(this):this.parts.caption.data("cke-caption-placeholder",this.editor.lang.imagebase.captionPlaceholder),n(o,!0)):this.editables.caption.getData()&&!this.parts.caption.data("cke-caption-placeholder")||(a(this),n(o,!1))}}}(),upload:(i={progressReporterType:n,setUp:function(t,e){t.on("paste",(function(a){var n=a.data.dataTransfer,o=n&&n.isFileTransfer(),r=n&&n.getFilesCount();if(!t.readOnly&&o){var s=[];e=t.widgets.registered[e.name];for(var l=0;l<r;l++)o=n.getFile(l),CKEDITOR.fileTools.isTypeSupported(o,e.supportedTypes)&&s.push(o);0!==s.length&&(a.cancel(),a.stop(),CKEDITOR.tools.array.forEach(s,(function(a,n){var o=i._spawnLoader(t,a,e,a.name);i._insertWidget(t,e,URL.createObjectURL(a),!0,{uploadId:o.id}),n!==s.length-1&&((o=t.getSelection().getRanges())[0].enlarge(CKEDITOR.ENLARGE_ELEMENT),o[0].collapse(!1))})))}}))},init:function(){this.once("ready",(function(){var t=this.data.uploadId;void 0!==t&&(t=this.editor.uploadRepository.loaders[t])&&this._beginUpload(this,t)}))},_isLoaderDone:function(t){return t.xhr&&4===t.xhr.readyState},_spawnLoader:function(t,e,a,n){var i=a.loadMethod||"loadAndUpload";return(t=t.uploadRepository.create(e,n,a.loaderType))[i](a.uploadUrl,a.additionalRequestParameters),t},_beginUpload:function(t,e){function a(){t.isInited()&&t.setData("uploadId",void 0),t.wrapper.removeClass("cke_widget_wrapper_uploading")}function n(){a(),!1!==t.fire("uploadFailed",{loader:e})&&t.editor.widgets.del(t)}var i={uploaded:function(){a(),t.fire("uploadDone",{loader:e})},abort:n,error:n},o=[];o.push(e.on("abort",i.abort)),o.push(e.on("error",i.error)),o.push(e.on("uploaded",i.uploaded)),this.on("destroy",(function(){CKEDITOR.tools.array.filter(o,(function(t){return t.removeListener(),!1}))})),t.setData("uploadId",e.id),!1!==t.fire("uploadStarted",e)&&t.progressReporterType&&(t._isLoaderDone(e)?i[e.status]&&i[e.status]():(t.wrapper.addClass("cke_widget_wrapper_uploading"),i=new t.progressReporterType,t.wrapper.append(i.wrapper),i.bindLoader(e)))},_insertWidget:function(t,e,a,n,i){var o=("function"==typeof e.defaults?e.defaults():e.defaults)||{};(o=CKEDITOR.tools.extend({},o)).src=a,a=CKEDITOR.dom.element.createFromHtml(e.template.output(o)),o=t.widgets.wrapElement(a,e.name);var r=new CKEDITOR.dom.documentFragment(o.getDocument());return r.append(o),!1!==n?(t.widgets.initOn(a,e,i),t.widgets.finalizeCreation(r)):a}},i),link:function(){function a(a,n,i){a.getCommand("unlink").on(n,(function(n){var o=t(a);o&&e(o,"link")&&(n.stop(),i&&"function"==typeof i&&i(this,o,a),n.cancel())}))}return{allowedContent:{a:{attributes:"!href"}},parts:{link:"a"},init:function(){this.editor.plugins.link&&this.editor.contextMenu&&this.on("contextMenu",(function(t){this.parts.link&&(t.data.link=t.data.unlink=CKEDITOR.TRISTATE_OFF)}))},setUp:function(n){n.plugins.link&&(n.contextMenu&&function(t){t.addMenuGroup("imagebase",10),t.addMenuItem("imagebase",{label:t.lang.link.menu,command:"link",group:"imagebase"})}(n),n.on("dialogShow",(function(a){var i,o,r=t(n),s=a.data;r&&e(r,"link")&&"link"===s._.name&&(i=s.getContentElement("info","linkDisplayText").getElement().getParent().getParent(),s.setupContent(r.data.link||{}),i.hide(),o=s.once("ok",function(t,a,n){return function(){if(n&&e(n,"link")){t.stop();var i={};a.commitContent(i),n.setData("link",i)}}}(a,s,r),null,null,9),s.once("hide",(function(){o.removeListener(),i.show()})))})),a(n,"exec",(function(t,e,a){e.setData("link",null),t.refresh(a,a.elementPath())})),a(n,"refresh",(function(t,e){t.setState(e.parts.link?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED)})))},data:function(t){var e=this.editor,a=t.data.link,n=this.element.findOne("img");if(void 0===a&&this.parts.link&&this.setData("link",CKEDITOR.plugins.link.parseLinkAttributes(this.editor,this.parts.link)),void 0!==a)if(null===a)this.parts.link.remove(!0),this.parts.link=null,delete t.data.link;else{t=this.parts;var i=n.getAscendant("a")||e.document.createElement("a");e=CKEDITOR.plugins.link.getLinkAttributes(e,a);CKEDITOR.tools.isEmpty(e.set)||i.setAttributes(e.set),e.removed.length&&i.removeAttributes(e.removed),i.contains(n)||(i.replace(n),n.move(i)),t.link=i}}}}()},s=100;a.prototype={updated:function(){},done:function(){this.remove()},aborted:function(){this.remove()},failed:function(){this.remove()},remove:function(){this.wrapper.remove()},bindLoader:function(t){function e(){a&&(CKEDITOR.tools.array.forEach(a,(function(t){t.removeListener()})),a=null)}var a=[],n=CKEDITOR.tools.eventsBuffer(s,(function(){t.uploadTotal&&this.updated(t.uploaded/t.uploadTotal)}),this);a.push(t.on("update",n.input,this)),a.push(t.once("abort",this.aborted,this)),a.push(t.once("uploaded",this.done,this)),a.push(t.once("error",this.failed,this)),a.push(t.once("abort",e)),a.push(t.once("uploaded",e)),a.push(t.once("error",e))}},n.prototype=new a,n.prototype.updated=function(t){t=Math.round(100*t),t=Math.max(t,0),t=Math.min(t,100),this.bar.setStyle("width",t+"%")},CKEDITOR.plugins.add("imagebase",{requires:"widget,filetools",lang:"az,bg,cs,da,de,de-ch,en,en-au,et,fa,fr,gl,hr,hu,it,ku,lt,lv,nb,nl,pl,pt,pt-br,ro,ru,sk,sq,sr,sr-latn,sv,tr,ug,uk,zh,zh-cn",init:function(t){o||(CKEDITOR.document.appendStyleSheet(this.path+"styles/imagebase.css"),o=!0),t.addContentsCss&&t.addContentsCss(this.path+"styles/imagebase.css")}}),CKEDITOR.plugins.imagebase={featuresDefinitions:r,addImageWidget:function(t,e,a){e=t.widgets.add(e,function(t,e){return(e=CKEDITOR.tools.object.merge({pathName:t.lang.imagebase.pathName,defaults:{imageClass:t.config.easyimage_class||"",alt:"",src:"",caption:""},template:'<figure class="{imageClass}"><img alt="{alt}" src="{src}" /><figcaption>{caption}</figcaption></figure>',allowedContent:{img:{attributes:"!src,alt,width,height"},figure:!0,figcaption:!0},requiredContent:"figure; img[!src]",features:[],editables:{caption:{selector:"figcaption",pathName:t.lang.imagebase.pathNameCaption,allowedContent:"br em strong sub sup u s; a[!href,target]"}},parts:{image:"img",caption:"figcaption"},upcasts:{figure:function(t){if(1===t.find("img",!0).length)return t}}},e)).upcast=CKEDITOR.tools.object.keys(e.upcasts).join(","),e}(t,a)),t.addFeature(e)},addFeature:function(t,e,a){function n(t,e){if(t||e)return function(){t&&t.apply(this,arguments),e&&e.apply(this,arguments)}}var i=CKEDITOR.tools.clone(this.featuresDefinitions[e]);return i.init=n(a.init,i.init),i.data=n(a.data,i.data),i.setUp&&(i.setUp(t,a),delete i.setUp),t=CKEDITOR.tools.object.merge(a,i),CKEDITOR.tools.isArray(t.features)||(t.features=[]),t.features.push(e),t},progressBar:n,progressReporter:a}}();