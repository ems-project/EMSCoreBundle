{%-  set data = {} -%}
{%-  set rowContextTemplate = template_from_string("{%- use '@EMSCore/datatable/row.json.twig' -%}"~table.rowContext~"{{ block('emsco_datatable_row') }}") -%}

{%- for line in table -%}
    {% set data = data|merge([ include(rowContextTemplate)|json_decode ]) %}
{%- endfor -%}

{%- set response = {
    data: data,
    draw: dataTableRequest.draw,
    recordsFiltered: table.count,
    recordsTotal: table.totalCount,
} -%}
{{- response|json_encode|raw -}}